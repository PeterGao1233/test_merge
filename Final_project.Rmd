---
title: "Final project"
runtime: shiny
output:
  flexdashboard::flex_dashboard:
    theme: cosmo
    vertical_layout: scroll
---

```{r}
library(tidyverse)
library(stringr)
library(httr)
library(rvest)
library(lubridate)
library(ggmap)
library(shiny)
library(shinythemes)
library(usdata)
library(maps)
library(grDevices)
library(flexdashboard)
library(ggmosaic)
library(RColorBrewer)
```


```{=html}
<style>                     
.navbar {
  background-color: black;
  border-color: white;
  menu-color:white
}

</style>
```
# About {data-navmenu="Menu"}

## Column {data-width = 400}

#### Authors

Lance Nemecek and Peter Gao

#### Background Information
About the TRFFS website: The TRFFS is a website where people can see the college track & field rankings and results.

We require the names of all MIAC athletes and their event times. The TFRRS website provides data back to 2015 so we can analyze data for the past 9 years of MIAC competition. We intend to use the shiny package to organize our findings in an easy to operate manner for a viewer of our website. Our key variables are the following: 

+ Athlete Name
+ Athlete School
+ Athlete time 
+ Distance
+ Date of Race
+ Finishing Position

These 5 variables will provide the necessary information we need for our analysis. 


#### Data Soures
+ Data from [TFRRS](https://www.tfrrs.org/) 
+ Data we will use in our final project from https://www.tfrrs.org/lists/4723/MIAC_Outdoor_Performance_List

#### Investigate Questions

+ Which schools are the best at each event?
+ Has the MIAC improved as the years progressed? 
+ How does each class year perform in college?
+ Does athletes with the top marks finish as expected?

# Which schools are the best at each event? {data-navmenu="Menu"}

## Column {data.height = 700}

Which schools are the best at each event?


In this question, we will consider the number of athletes from each school in the top 30 in the 100-meter event to determine which school is stronger. That is, if a school has the most athletes in the top thirty, then that school is best at the event.

``````{r, echo = FALSE}
all_running_events = read_rds("AllRunningEvents.csv")
```


```{r, echo = FALSE}
all_running_events <- all_running_events %>%
    mutate(date = mdy(date)) %>%
    mutate(year_date = year(date))
```


### Select Input
```{r, echo = FALSE}
inputPanel(
  selectInput(inputId = "categ",
              label = h3("Event"),
              choices = c("one_hundred", "two_hundred", "four_hundred", "eight_hundred", "fifteen_hundred", "five_k", "ten_k", "one_ten_hurdles", "four_hundred_hurdles", "steeplechase"),
              selected = "one_hundred"),
  
  selectInput(inputId = "categ1",
              label = h3("Year"),
              choices = c("2024", "2023", "2022", "2021", "2019", "2018", "2017", "2015"),
              selected = "2024")
)
```

```{r, echo = FALSE}
testall_running_events <- all_running_events |>
  pivot_wider(names_from = event,
              values_from = school)
view(testall_running_events)
```


Column 
-------------------------
### Select Input

```{r, echo = FALSE}
renderPlot({
  filtered_data <- testall_running_events |>
    filter(!is.na(.data[[input$categ]]), year(date) == as.numeric(input$categ1))

  ggplot(filtered_data, aes(x = .data[[input$categ]])) +
    geom_bar(fill = "lightblue", color = "black", alpha = 0.7) +
    labs(title = "Distribution of Events",
         x = "Event",
         y = "Frequency") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    scale_fill_manual(values = c("lightblue", "green"))  
})

```


# Has the MIAC improved as the years progressed? {data-navmenu="Menu"}

To determine how has the MIAC improved as the years progressed, we can measure how the champion for each event perform each year. That is, we are making a scatterplot with line, which x-axis is year from 2015 to 2024, and the y-axis is the time or meters due to different events.

Column 
-------------------------
In the following plots, we are measuring the performance of champions in events that measure their results in seconds.

```{r, include = FALSE}
testall_running_events <- all_running_events |>
  pivot_wider(names_from = event,
              values_from = school)
view(testall_running_events)
```


```{r, fig.height=4}
inputPanel(
  selectInput(inputId = "champs",
              label = h3("Running Events"),
              choices = c("one_hundred", "two_hundred", "four_hundred", "eight_hundred", "fifteen_hundred", "five_k", "ten_k", "one_ten_hurdles", "four_hundred_hurdles", "steeplechase"),
              selected = "one_hundred"))
```

```{r, echo=FALSE}
renderPlot({
  testall_running_events |>
    filter(seed == 1, !is.na(.data[[input$champs]])) |>
    ggplot(aes(x = year_date, y = time)) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE, color = "green", alpha = .1)+
    labs(x = "Year", y = "Times", title = "Progression of MIAC Running Events") +
    theme_minimal()
})
```

```{r}
all_relays = read_rds("AllRelays.CSV")
```

```{r, echo = FALSE}
all_relays <- all_relays %>%
    mutate(date = mdy(date)) %>%
    mutate(year_date = year(date))
```


```{r, fig.height=3}
inputPanel(
  selectInput(inputId = "relays",
              label = h3("Relays"),
              choices = c("4x100", "4x400"),
              selected = "4x100"))
```

```{r, echo = FALSE}
all_relays <- all_relays |>
  pivot_wider(names_from = event,
              values_from = meet)
view(all_relays)
```



```{r, echo=FALSE}
renderPlot({
  all_relays |>
    filter(seed == 1, !is.na(.data[[input$relays]])) |>
    ggplot(aes(x = year_date, y = time)) +
    geom_point() +
    labs(x = "Year", y = "Times", title = "Progression of MIAC Relays") +
    theme_minimal()
})
```

```{r, echo = FALSE}
all_field_events = read_rds("AllFieldEvents.csv")
```

```{r, echo = FALSE}
all_field_events <- all_field_events %>%
    mutate(date = mdy(date)) %>%
    mutate(year_date = year(date))
```

```{r, echo = FALSE}
testall_field_events <- all_field_events |>
  pivot_wider(names_from = event,
              values_from = meet)
view(testall_field_events)
```


```{r, fig.height=2}
inputPanel(
  selectInput(inputId = "field",
              label = h3("Field Events"),
             choices = c("High Jump","Pole Vault", "Long Jump", "Triple Jump","Shot Put", "Discus", "Hammer", "Javelin"),
              selected = "High Jump"))
```

```{r, echo=FALSE}
renderPlot({
  testall_field_events |>
    filter(seed == 1, !is.na(.data[[input$field]])) |>
    ggplot(aes(x = year_date, y = mark)) +
    geom_point() +
    labs(x = "Year", y = "Meters", title = "Field Events") +
    theme_minimal()
})
```

```{r}
tags$h1("Decathalon")
```

```{r}
combined_tableDecathlon = read_rds("Decathalon.CSV")
```

```{r}
combined_tableDecathlon<- combined_tableDecathlon %>%
    mutate(date = mdy(date)) %>%
    mutate(year_date = year(date))
```

```{r, echo=FALSE}
combined_tableDecathlon |>
  filter(seed == 1)|>
  ggplot(aes(x = year_date, y = points)) +
  geom_point() +
  labs(x = "Year", y = "points", title = "MIAC Decathlon") +
  theme_minimal()
```

# How does each class year perform in each college? {data-navmenu="Menu"}

In this question, we will filter each class year, and see how they perform in different events in different years. To measure how they perform, we will examine the average seed rank for each events and in each college. 

```{r, echo = FALSE}
#| include: FALSE
library(tidyverse)
library(stringr)
library(rvest)
library(httr)
```

```{r, echo = FALSE}
all_running_events = read_rds("AllRunningEvents.csv")
all_field_events = read_rds("AllFieldEvents.csv")
```

```{r, echo = FALSE}
all_running_events <- all_running_events %>%
    mutate(date = mdy(date)) %>%
    mutate(year_date = year(date))
```

How does each class year preform?(runing events)


```{r, include = FALSE}
avg_place <- all_running_events |>
  filter(!is.na(class_year) & class_year != "") |>
  complete(year_date, class_year, fill = list(seed = NA)) |>
  group_by(class_year, year_date) |>
  summarize(avg_place = mean(seed, na.rm = TRUE))
avg_place
```

```{r, echo = FALSE}
inputPanel(
  selectInput(inputId = "avgplace",
              label = h3("class_Year"),
              choices = c("FR-1", "SO-2", "JR-3", "SR-4"),
              selected = "FR-1"))
```


```{r, echo = FALSE}
renderPlot({
  avg_place |>
    filter(class_year == input$avgplace) |>
    ggplot(aes(x = year_date, y = avg_place)) +
    geom_point(color = "skyblue") +
    geom_smooth(method = "lm", se = FALSE, color = "green", alpha = .1) + 
    theme_minimal()
})
```


```{r, include = FALSE}
class_count <- all_running_events |>
  complete(year_date, class_year, fill = list(seed = NA)) |>
  group_by(year_date, class_year) |>
  summarize(total_participants = sum(n_distinct(name)))|>
  slice(-1)
```

```{r, echo = FALSE}
inputPanel(
  selectInput(inputId = "classcount",
              label = h3("class_Year"),
              choices = c("FR-1", "SO-2", "JR-3", "SR-4"),
              selected = "FR-1"))
```


```{r, echo = FALSE}
renderPlot({
  class_count |>
    filter(class_year == input$classcount) |>
    ggplot(aes(x = year_date, y = total_participants)) +
    geom_point(color = "skyblue") +
    geom_smooth(method = "lm", se = FALSE, color = "green", alpha = .1) + 
    theme_minimal()
})
```

How does each year perform in college(field events)
```{r, include = FALSE}
all_field_events <- all_field_events |>
    mutate(date = mdy(date)) |>
    mutate(year_date = year(date))
```

```{r, include = FALSE}
avg_place2 <- all_field_events %>%
  filter(!is.na(class_year) & class_year != "") %>%
  complete(year_date, class_year, fill = list(seed = NA)) %>%
  mutate(seed = as.numeric(seed)) %>%  
  group_by(class_year, year_date) %>%
  summarize(avg_place = mean(seed, na.rm = TRUE), .groups = "drop")
avg_place2
```


```{r, include = FALSE}
class_count2 <- all_field_events |>
  complete(year_date, class_year, fill = list(seed = NA)) |>
  group_by(year_date, class_year) |>
  summarize(total_participants = sum(n_distinct(name)))|>
  slice(-1)
```

```{r, echo = FALSE}
inputPanel(
  selectInput(inputId = "avgplace2",
              label = h3("class_Year"),
              choices = c("FR-1", "SO-2", "JR-3", "SR-4"),
              selected = "FR-1"))
```


```{r, echo = FALSE}
renderPlot({
  avg_place2 |>
    filter(class_year == input$avgplace2) |>
    ggplot(aes(x = year_date, y = avg_place)) +
    geom_point(color = "skyblue") +
    geom_smooth(method = "lm", se = FALSE, color = "green", alpha = .1) + 
    theme_minimal()
})
```

```{r, echo = FALSE}
inputPanel(
  selectInput(inputId = "classcount2",
              label = h3("class_Year"),
              choices = c("FR-1", "SO-2", "JR-3", "SR-4"),
              selected = "FR-1"))
```


```{r, echo = FALSE}
renderPlot({
  class_count2 |>
    filter(class_year == input$classcount2) |>
    ggplot(aes(x = year_date, y = total_participants)) +
    geom_point(color = "skyblue") +
    geom_smooth(method = "lm", se = FALSE, color = "green", alpha = .1) + 
    theme_minimal()
})
```

### Commentary

```{r}
p("." )
```
# Does athletes with the top marks finish as expected? {data-navmenu="Menu"}

## Column

```{r}

```

### section1

```{r}

```

### section2

```{r}

```

## Column

### Commentary

```{r}
p("")
```

### section 3

```{r}

```

### section4

```{r}

```


## Column

# Discussion {data-navmenu="Menu"}
